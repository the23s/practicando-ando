<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo: Device Orientation API</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            background-color: #F5F5F5;
            color: #111;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* El contenedor principal que define el espacio 3D */
        .scene {
            width: 80vw;
            height: 80vh;
            max-width: 400px;
            max-height: 600px;
            position: relative;
            
            /* 'perspective' es la clave para crear la sensación de profundidad.
               Un valor más bajo significa una perspectiva más extrema. */
            perspective: 1000px;
        }

        /* El 'card' es el elemento que rotará. 'preserve-3d' hace que sus
           hijos también vivan en el mismo espacio 3D. */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s linear; /* Suaviza el movimiento */
            border: 4px solid #111;
            background-color: #FAFAFA;
        }

        .card-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            box-sizing: border-box;
        }

        /* Cada capa se empuja a una profundidad (eje Z) diferente.
           Valores positivos lo acercan, negativos lo alejan. */
        .background-layer {
            transform: translateZ(-100px) scale(1.5);
            font-size: 8rem;
            color: #e0e0e0;
        }

        .text-layer {
            transform: translateZ(50px);
            flex-direction: column;
        }
        
        .text-layer h1 {
            font-size: 3rem;
            margin: 0;
            background-color: #FFFF00;
            padding: 0.5rem 1rem;
            border: 4px solid #111;
        }

        .text-layer p {
            font-size: 1.2rem;
            margin-top: 1rem;
        }

        #permission-button, #fallback-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            padding: 1rem 2rem;
            border: 4px solid #111;
            background-color: #00FF00;
            cursor: pointer;
            z-index: 100;
            text-align: center;
        }
        
        #fallback-message {
            background-color: #FFC107;
            cursor: default;
            display: none; /* Oculto por defecto */
        }
    </style>
</head>
<body>

    <div class="scene">
        <div class="card" id="card">
            <div class="card-layer background-layer">API</div>
            <div class="card-layer text-layer">
                <h1>GYRO-FX</h1>
                <p>Mueve tu dispositivo para controlar la perspectiva.</p>
            </div>
        </div>
    </div>

    <button id="permission-button">Activar Efecto</button>
    <div id="fallback-message">Abre en un móvil con giroscopio para ver el efecto.</div>

    <script>
        const card = document.getElementById('card');
        const permissionButton = document.getElementById('permission-button');
        const fallbackMessage = document.getElementById('fallback-message');
        let rafId = null;

        function handleOrientation(event) {
            // event.beta es la inclinación adelante-atrás (-180 a 180)
            // event.gamma es la inclinación izquierda-derecha (-90 a 90)
            const { beta, gamma } = event;

            // Cancelamos el frame anterior para evitar trabajo innecesario
            if (rafId) {
                cancelAnimationFrame(rafId);
            }
            
            // Usamos requestAnimationFrame para actualizar la animación
            // de forma sincronizada con el repintado del navegador.
            // Esto es CRUCIAL para un rendimiento suave.
            rafId = requestAnimationFrame(() => {
                // Mapeamos los valores del giroscopio a un rango de rotación más pequeño
                // para que el efecto sea sutil y controlable.
                const rotateX = (beta - 90) * -0.15; // Invertimos y reducimos el rango
                const rotateY = gamma * 0.15;

                // Aplicamos la transformación al elemento 'card'.
                // La GPU se encarga de todo el trabajo pesado de renderizado 3D.
                card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            });
        }
        
        function requestDeviceOrientationPermission() {
            // La nueva especificación requiere pedir permiso explícitamente.
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                            permissionButton.style.display = 'none';
                        } else {
                            permissionButton.textContent = 'Permiso denegado';
                            permissionButton.disabled = true;
                        }
                    })
                    .catch(console.error);
            } else {
                // Para navegadores más antiguos o que no requieren permiso (como en Android)
                window.addEventListener('deviceorientation', handleOrientation);
                permissionButton.style.display = 'none';
            }
        }

        // Comprobamos si la API es compatible al cargar la página.
        if (window.DeviceOrientationEvent) {
            permissionButton.addEventListener('click', requestDeviceOrientationPermission);
            fallbackMessage.style.display = 'none';
        } else {
            permissionButton.style.display = 'none';
            fallbackMessage.style.display = 'block';
        }

    </script>
</body>
</html>
